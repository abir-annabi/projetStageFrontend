<h2 class="text-2xl font-semibold mb-4">Gestion des Utilisateurs</h2>

<div class="card p-4 shadow-lg rounded-lg">
  <div class="flex justify-between items-center mb-3">
    <span class="p-input-icon-left">
      <i class="pi pi-search"></i>
      <input 
        pInputText 
        type="text" 
        class="p-inputtext-sm w-full md:w-72" 
        (input)="dt.filterGlobal($any($event.target).value, 'contains')" 
        placeholder="Rechercher un utilisateur..."
      />
    </span>
    <button 
      pButton 
      type="button" 
      label="Ajouter" 
      icon="pi pi-user-plus" 
      class="p-button-success p-button-sm" 
      (click)="addUser()"
    ></button>
  </div>

  <p-table 
    #dt 
    [value]="users" 
    responsiveLayout="scroll" 
    [globalFilterFields]="['name', 'email', 'role']"
    [loading]="loading"
  >
    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="name">Nom <p-sortIcon field="name"></p-sortIcon></th>
        <th pSortableColumn="email">Email <p-sortIcon field="email"></p-sortIcon></th>
        <th pSortableColumn="role">Rôle <p-sortIcon field="role"></p-sortIcon></th>
        <th class="text-center">Actions</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-user>
      <tr>
        <td>{{ user.name }}</td>
        <td>{{ user.email }}</td>
        <td>
          <span 
            [ngClass]="{'badge bg-green-500 text-white px-2 py-1 rounded-lg': user.role === 'Admin', 'badge bg-blue-500 text-white px-2 py-1 rounded-lg': user.role === 'user'}">
            {{ user.role }}
          </span>
        </td>
        <td class="text-center">
          <button 
            pButton 
            type="button" 
            icon="pi pi-pencil" 
            class="p-button-rounded p-button-sm p-button-warning mx-1" 
            (click)="editUser(user.id)"
          ></button>
          <button 
            pButton 
            type="button" 
            icon="pi pi-trash" 
            class="p-button-rounded p-button-sm p-button-danger mx-1" 
            (click)="confirmDelete(user.id)"
          ></button>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr><td colspan="4" class="text-center">Aucun utilisateur trouvé.</td></tr>
    </ng-template>
  </p-table>

  <!-- PAGINATION -->
  <p-paginator 
    (onPageChange)="onPageChange($event)" 
    [first]="first" 
    [rows]="rows" 
    [totalRecords]="totalRecords" 
    [rowsPerPageOptions]="[5, 10, 20]" 
  ></p-paginator>
</div>

<p-confirmDialog header="Confirmation" message="Voulez-vous supprimer cet utilisateur ?" icon="pi pi-exclamation-triangle"></p-confirmDialog>
